Origin: https://github.com/git/git/commit/8a96dbcb339d25ba1813632319ea4052bc586ddf
Reviewed-by: Sylvain Beucler <beuc@debian.org>
Last-Update: 2022-12-12

From 8a96dbcb339d25ba1813632319ea4052bc586ddf Mon Sep 17 00:00:00 2001
From: Taylor Blau <me@ttaylorr.com>
Date: Fri, 29 Jul 2022 15:16:10 -0400
Subject: [PATCH] t/t1NNN: allow local submodules

To prepare for the default value of `protocol.file.allow` to change to
"user", ensure tests that rely on local submodules can initialize them
over the file protocol.

Tests that only need to interact with submodules in a limited capacity
have individual Git commands annotated with the appropriate
configuration via `-c`. Tests that interact with submodules a handful of
times use `test_config_global` instead.

Signed-off-by: Taylor Blau <me@ttaylorr.com>
---
 t/t1091-sparse-checkout-builtin.sh | 3 ++-
 t/t1500-rev-parse.sh               | 3 ++-
 2 files changed, 4 insertions(+), 2 deletions(-)

Index: git-2.20.1/t/t1500-rev-parse.sh
===================================================================
--- git-2.20.1.orig/t/t1500-rev-parse.sh
+++ git-2.20.1/t/t1500-rev-parse.sh
@@ -139,7 +139,8 @@ test_expect_success 'showing the superpr
 	test_commit -C super test_commit &&
 	test_create_repo sub &&
 	test_commit -C sub test_commit &&
-	git -C super submodule add ../sub dir/sub &&
+	git -c protocol.file.allow=always \
+		-C super submodule add ../sub dir/sub &&
 	echo $(pwd)/super >expect  &&
 	git -C super/dir/sub rev-parse --show-superproject-working-tree >out &&
 	test_cmp expect out &&
