Origin: https://github.com/git/git/commit/99f4abb8dae4c9c604e5d5cf255958bbe537b928
Reviewed-by: Sylvain Beucler <beuc@debian.org>
Last-Update: 2022-12-13

From 99f4abb8dae4c9c604e5d5cf255958bbe537b928 Mon Sep 17 00:00:00 2001
From: Taylor Blau <me@ttaylorr.com>
Date: Fri, 29 Jul 2022 15:20:03 -0400
Subject: [PATCH] t/2NNNN: allow local submodules

To prepare for the default value of `protocol.file.allow` to change to
"user", ensure tests that rely on local submodules can initialize them
over the file protocol.

Tests that only need to interact with submodules in a limited capacity
have individual Git commands annotated with the appropriate
configuration via `-c`. Tests that interact with submodules a handful of
times use `test_config_global` instead. Test scripts that rely on
submodules throughout use a `git config --global` during a setup test
towards the beginning of the script.

Signed-off-by: Taylor Blau <me@ttaylorr.com>
---
 t/t2400-worktree-add.sh       | 2 ++
 t/t2403-worktree-move.sh      | 7 +++++--
 t/t2405-worktree-submodule.sh | 1 +
 3 files changed, 8 insertions(+), 2 deletions(-)

Index: git-2.20.1/t/t7410-submodule-checkout-to.sh
===================================================================
--- git-2.20.1.orig/t/t7410-submodule-checkout-to.sh
+++ git-2.20.1/t/t7410-submodule-checkout-to.sh
@@ -7,6 +7,7 @@ test_description='Combination of submodu
 base_path=$(pwd -P)
 
 test_expect_success 'setup: make origin'  '
+	git config --global protocol.file.allow always &&
 	mkdir -p origin/sub &&
 	(
 		cd origin/sub && git init &&
