Origin: https://github.com/git/git/commit/1703751f21d286b383c198157a1342c35ebc11b7
Reviewed-by: Sylvain Beucler <beuc@debian.org>
Last-Update: 2022-12-10

From 1703751f21d286b383c198157a1342c35ebc11b7 Mon Sep 17 00:00:00 2001
From: Jeff Hostetler <jeffhost@microsoft.com>
Date: Mon, 15 Apr 2019 13:39:42 -0700
Subject: [PATCH] config: initialize opts structure in repo_read_config()

Initialize opts structure in repo_read_config().

This change fixes a crash in later commit after a new field is added
to the structure.

In commit 3b256228a66f8587661481ef3e08259864f3ba2a, repo_read_config()
was added.  It only initializes 3 fields in the opts structure.  It is
passed to config_with_options() and then to do_git_config_sequence().
However, do_git_config_sequence() drops the opts on the floor and calls
git_config_from_file() rather than git_config_from_file_with_options(),
so that may be why this hasn't been a problem in the past.

Signed-off-by: Johannes Schindelin <johannes.schindelin@gmx.de>
Signed-off-by: Jeff Hostetler <jeffhost@microsoft.com>
Signed-off-by: Junio C Hamano <gitster@pobox.com>
---
 config.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

Index: git-2.20.1/config.c
===================================================================
--- git-2.20.1.orig/config.c
+++ git-2.20.1/config.c
@@ -2009,7 +2009,7 @@ int git_configset_get_pathname(struct co
 /* Functions use to read configuration from a repository */
 static void repo_read_config(struct repository *repo)
 {
-	struct config_options opts;
+	struct config_options opts = { 0 };
 
 	opts.respect_includes = 1;
 	opts.commondir = repo->commondir;
